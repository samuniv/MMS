@page
@model MeetingManagementSystem.Web.Pages.Admin.AuditLogsModel
@{
    ViewData["Title"] = "Audit Logs";
}

<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Audit Logs</h1>
        <a href="/Admin/Dashboard" class="btn btn-ghost">‚Üê Back to Dashboard</a>
    </div>

    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h2 class="card-title">Filter Logs</h2>
            <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Start Date</span>
                    </label>
                    <input type="date" asp-for="StartDate" class="input input-bordered" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">End Date</span>
                    </label>
                    <input type="date" asp-for="EndDate" class="input input-bordered" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">User ID (Optional)</span>
                    </label>
                    <input type="number" asp-for="UserId" class="input input-bordered" placeholder="All Users" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">&nbsp;</span>
                    </label>
                    <button type="submit" class="btn btn-primary">Filter Logs</button>
                </div>
            </form>
        </div>
    </div>

    @if (Model.AuditLogs.Any())
    {
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">Audit Log Entries (@Model.AuditLogs.Count())</h2>

                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Entity Type</th>
                                <th>Entity ID</th>
                                <th>IP Address</th>
                                <th>Changes</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var log in Model.AuditLogs)
                            {
                                <tr>
                                    <td>@log.Id</td>
                                    <td class="text-sm">@log.Timestamp.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                    <td>@log.UserName</td>
                                    <td>
                                        <span class="badge @(log.Action.Contains("Create") ? "badge-success" : 
                                                             log.Action.Contains("Update") ? "badge-info" : 
                                                             log.Action.Contains("Delete") ? "badge-error" : "badge-primary")">
                                            @log.Action
                                        </span>
                                    </td>
                                    <td>@log.EntityType</td>
                                    <td>@log.EntityId</td>
                                    <td class="text-sm text-gray-500">@log.IpAddress</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(log.Changes))
                                        {
                                            <button class="btn btn-xs btn-ghost" onclick="document.getElementById('showChanges_@log.Id').showModal()">View</button>
                                            <dialog id="showChanges_@log.Id" class="modal">
                                                <div class="modal-box">
                                                    <h3 class="font-bold text-lg">Change Details</h3>
                                                    <pre class="text-sm mt-4 bg-base-200 p-4 rounded overflow-auto">@log.Changes</pre>
                                                    <div class="modal-action">
                                                        <form method="dialog">
                                                            <button class="btn">Close</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </dialog>
                                        }
                                        else
                                        {
                                            <span class="text-gray-400">-</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="mt-6 stats shadow">
                    <div class="stat">
                        <div class="stat-title">Total Entries</div>
                        <div class="stat-value text-primary">@Model.AuditLogs.Count()</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">Unique Users</div>
                        <div class="stat-value text-secondary">@Model.AuditLogs.Select(l => l.UserName).Distinct().Count()</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">Actions Logged</div>
                        <div class="stat-value text-accent">@Model.AuditLogs.Select(l => l.Action).Distinct().Count()</div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <partial name="_EmptyState" model="@("No audit logs found for the selected criteria.")" />
    }
</div>
